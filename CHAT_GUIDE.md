# Руководство по работе с чат-агентом

Интерактивный помощник для работы с базой знаний иммиграционных программ.

---

## 🚀 Быстрый старт

### Запуск интерактивного чата

```bash
python3 chat_agent.py
```

Откроется интерактивная сессия:

```
╔════════════════════════════════════════════════════════════════╗
║           ЧАТ-АГЕНТ — БАЗА ЗНАНИЙ INTERMARK GLOBAL            ║
╚════════════════════════════════════════════════════════════════╝

Задавайте вопросы об иммиграционных программах.
Агент использует только материалы из базы знаний.

Команды:
  /помощь   — показать справку
  /статистика — статистика базы знаний
  /выход    — завершить работу

────────────────────────────────────────────────────────────────

❓ Вопрос:
```

### Быстрый вопрос (без интерактива)

```bash
python3 chat_agent.py "Ваш вопрос"
```

---

## 💬 Примеры вопросов

### На русском языке

```bash
python3 chat_agent.py "гражданство Malta"
python3 chat_agent.py "ВНЖ в Португалии"
python3 chat_agent.py "требования для постоянного проживания в Греции"
python3 chat_agent.py "инвестиции в недвижимость Турция"
```

### На английском языке

```bash
python3 chat_agent.py "Portugal residence permit"
python3 chat_agent.py "Malta citizenship investment"
python3 chat_agent.py "Golden Visa Greece"
python3 chat_agent.py "Caribbean citizenship programs"
```

### Смешанные запросы

```bash
python3 chat_agent.py "citizenship Мальта"
python3 chat_agent.py "ВНЖ Portugal"
```

---

## 🎯 Принципы работы агента

### ✅ Что делает агент

1. **Ищет в базе знаний**
   - Использует только материалы из папки `knowledge/`
   - Поддерживает русский и английский языки
   - Понимает синонимы (citizenship = гражданство, residence = ВНЖ)

2. **Предоставляет точные ответы**
   - Извлекает релевантные фрагменты из документов
   - Указывает источники информации
   - Ссылается на конкретные слайды презентаций

3. **Честно сообщает об отсутствии данных**
   - Если информации нет — говорит прямо
   - Не придумывает факты
   - Не делает предположений

### ❌ Чего НЕ делает агент

1. **Не фантазирует**
   - Не использует внешние источники
   - Не дополняет информацию из интернета
   - Не делает выводов, которых нет в материалах

2. **Не даёт субъективных оценок**
   - Только факты из презентаций
   - Без эмоций и метафор
   - Без рекомендаций (если нет в материалах)

---

## 📋 Формат ответов

### Простой ответ

```
## Ответ

Malta предлагает программу гражданства через инвестиции.
Минимальная сумма инвестиций составляет €600,000.
Срок обработки: 12-14 месяцев.

---

**Источники:**
- raw/Intermark. Malta Citizenship ENG.pdf → слайды 3–7

*Примечание: информация из нескольких источников.*
```

### Развёрнутый ответ

```
## Ответ

### Требования для программы

Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

### Преимущества

Ut enim ad minim veniam, quis nostrud exercitation ullamco.

### Процесс подачи

Laboris nisi ut aliquip ex ea commodo consequat.

---

**Источники:**
- raw/Intermark. Malta Citizenship ENG.pdf → слайды 3–7
- raw/Intermark. Malta Permanent Residence ENG.pdf → слайды 5–9

*Примечание: информация из нескольких источников.*
```

### Когда информации нет

```
❌ Не знаю — нет в материалах.

По вашему запросу не найдено информации в базе знаний.
```

---

## 🔧 Команды в интерактивном режиме

### `/помощь`

Показывает справку по работе с агентом:

```
═══════════════════════════════════════════════════════════════
СПРАВКА — ЧАТ-АГЕНТ
═══════════════════════════════════════════════════════════════

Агент отвечает на вопросы о:
  • Программах гражданства
  • Видах на жительство
  • Постоянном проживании
  • Инвестиционных возможностях
  • Требованиях и условиях программ

Примеры вопросов:
  • Какие программы гражданства есть в Португалии?
  • Требования для получения вида на жительство в Мальте?
  • Сколько стоит citizenship by investment в странах Карибского бассейна?
```

### `/статистика`

Показывает статистику загруженной базы знаний:

```
═══════════════════════════════════════════════════════════════
СТАТИСТИКА БАЗЫ ЗНАНИЙ
═══════════════════════════════════════════════════════════════

📚 Всего документов: 50
🌍 Категорий (стран): 43

📋 Распределение по типам:
  • Вид на жительство: 24
  • Гражданство: 15
  • Постоянное проживание: 7
  • Общая информация: 3
  • Паспорт: 1
```

### `/выход`

Завершает работу чата.

---

## 🔍 Поддерживаемые типы запросов

### По странам

```
Португалия
Portugal
Malta
Мальта
Greece
Греция
```

### По типам программ

```
гражданство / citizenship
ВНЖ / вид на жительство / residence permit / residence
ПМЖ / постоянное проживание / permanent residence / permanent
паспорт / passport
Golden Visa
```

### По темам

```
инвестиции / investment
стартап / startup
недвижимость / real estate
финансовая независимость / financial independence
```

---

## 💡 Советы по работе

### 1. Формулируйте конкретные вопросы

❌ **Плохо:** "Расскажи про Мальту"  
✅ **Хорошо:** "Какие требования для гражданства Мальты?"

❌ **Плохо:** "Что есть в Европе?"  
✅ **Хорошо:** "Какие страны ЕС предлагают Golden Visa?"

### 2. Используйте ключевые слова

- Название страны
- Тип программы (citizenship, residence, etc.)
- Тема (investment, real estate, etc.)

### 3. Комбинируйте языки

Агент понимает:
- `гражданство Malta`
- `Portugal ВНЖ`
- `residence permit Португалия`

### 4. Задавайте уточняющие вопросы

После первого ответа можете уточнить:
- "А сколько это стоит?"
- "Какие сроки?"
- "Что нужно для подачи?"

---

## 🎓 Примеры диалогов

### Пример 1: Простой вопрос

```
❓ Вопрос: гражданство Malta

## Ответ

Malta предлагает программу гражданства через инвестиции
(Citizenship by Investment). Основные требования:
минимальная инвестиция €600,000, срок обработки 12-14 месяцев.

---

**Источники:**
- raw/Intermark. Malta Citizenship ENG.pdf → слайды 1–12
```

### Пример 2: Сравнительный вопрос

```
❓ Вопрос: Portugal residence permit requirements

## Ответ

[Информация о требованиях для ВНЖ в Португалии
из нескольких программ: инвестиции в фонды,
финансовая независимость, и т.д.]

---

**Источники:**
- raw/Intermark. Portugal RP. Arish Capital Partners ENG.pdf → слайды 1–14
- raw/Intermark. Portugal residence permit based on financial independence ENG.pdf → слайды 1–9
```

### Пример 3: Информация отсутствует

```
❓ Вопрос: гражданство Антарктиды

❌ Не знаю — нет в материалах.

По вашему запросу не найдено информации в базе знаний.
```

---

## 🔬 Технические детали

### Алгоритм поиска

1. **Нормализация запроса**
   - Приведение к нижнему регистру
   - Добавление синонимов
   - Разбиение на ключевые слова

2. **Поиск по документам**
   - Поиск в заголовках (высокий приоритет)
   - Поиск в категориях
   - Поиск в теле документа
   - Подсчёт релевантности

3. **Извлечение контекста**
   - Находит фрагменты с упоминанием запроса
   - Извлекает контекст (±300 символов)
   - Форматирует ответ

4. **Формирование ответа**
   - Топ-3 наиболее релевантных документа
   - Извлечение источников из метаданных
   - Добавление ссылок на слайды

### Словарь синонимов

```python
{
    'гражданство': ['citizenship', 'гражданство', 'паспорт'],
    'вид на жительство': ['residence permit', 'вид на жительство', 'внж', 'residence'],
    'постоянное проживание': ['permanent residence', 'постоянное проживание', 'пмж', 'permanent'],
    'инвестиции': ['investment', 'инвестиции', 'invest'],
    'portugal': ['portugal', 'португалия'],
    'malta': ['malta', 'мальта'],
    ...
}
```

---

## ⚙️ Устранение неполадок

### Проблема: "База знаний пуста"

**Решение:**
```bash
python3 build_knowledge.py
```

### Проблема: Агент не находит информацию

**Возможные причины:**
1. Информации действительно нет в базе
2. Используются нестандартные термины
3. Опечатка в названии страны

**Решение:**
- Попробуйте другие формулировки
- Используйте английские термины
- Проверьте правописание

### Проблема: Ответ не релевантен

**Решение:**
- Уточните вопрос
- Добавьте больше ключевых слов
- Используйте конкретные термины

---

## 📊 Метрики качества

### Покрытие базы знаний

- **Документов:** 50
- **Стран:** 43
- **Типов программ:** 5
- **Общий объём:** 66,299 слов

### Точность ответов

- ✅ Все ответы основаны только на материалах
- ✅ Ссылки на источники в каждом ответе
- ✅ Контрольные суммы для проверки актуальности

---

## 🔄 Обновление базы знаний

Если база знаний обновлена, перезапустите агента:

```bash
# 1. Обновить базу
python3 update_knowledge.py

# 2. Перезапустить чат
python3 chat_agent.py
```

Агент автоматически загружает актуальную версию при запуске.

---

## 📝 Ограничения

### Что агент НЕ может

1. ❌ Отвечать на вопросы вне базы знаний
2. ❌ Давать юридические консультации
3. ❌ Делать прогнозы
4. ❌ Сравнивать программы (если нет явного сравнения в материалах)
5. ❌ Рекомендовать конкретные программы

### Что агент МОЖЕТ

1. ✅ Находить информацию в базе
2. ✅ Извлекать факты из документов
3. ✅ Указывать источники
4. ✅ Отвечать на русском и английском
5. ✅ Понимать синонимы и аббревиатуры

---

## 🎯 Лучшие практики

### Для точных ответов

1. **Используйте конкретные термины**
   - ✅ "Malta citizenship investment requirements"
   - ❌ "Хочу в Мальту"

2. **Указывайте страну**
   - ✅ "Portugal residence permit cost"
   - ❌ "Сколько стоит ВНЖ?"

3. **Один вопрос за раз**
   - ✅ "Malta citizenship requirements"
   - ❌ "Расскажи про Мальту, Португалию и Грецию"

4. **Проверяйте источники**
   - Агент всегда указывает источник
   - Можете проверить по ссылке на слайды
   - При сомнениях - откройте исходный PDF

---

---

## 📊 Логирование неотвеченных вопросов

### Автоматическое отслеживание пробелов

Агент автоматически фиксирует все вопросы, на которые ответил **"не знаю — нет в материалах"**.

**Файл лога:** `knowledge/_unanswered_log.md`

**Что логируется:**
- Дата вопроса
- Тема (ключевые слова)
- Полный текст вопроса
- Контекст диалога
- Версия базы знаний
- Хеш вопроса (для проверки дубликатов)

**Пример записи:**
```
| 2025-10-14 | антарктида программа гражданства | Антарктида программа гражданства | [антарктида; программа; гражданства] | Нет контекста | 1cb410ce | 9da42750 |
```

**Просмотр лога:**
```bash
cat knowledge/_unanswered_log.md
```

**Подробнее:** См. `UNANSWERED_LOG_GUIDE.md`

---

*Последнее обновление: 2025-10-14*

